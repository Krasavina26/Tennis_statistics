# Описание
Система на основе Computer Vision, позволяющая получать характеристики по видеозаписи игры в теннис двух игроков.

# Инструкция
Сперва загрузите свои веса моделей в папку models и свое исходное видео в папку input_videos.

Исправьте в файле constants/__init__.py рост ваших игроков на видео (PLAYER_1_HEIGHT_METERS - рост ближайшего к камере игрока, PLAYER_2_HEIGHT_METERS - второго игрока, стоящего дальше от камеры).

Уточнение:
  * main.py - получение характеристик без отрисовки bbox'ов и предсказанных точек корта, без разделения корта на зоны
  * main_with_draw.py - то же самое, но со всей отладочной информацией

# Итоговый результат

В результате на исходном видео справа сверху отрисовывается мини корт и справа снизу табло со скоростями игроков:

| Без отладки | С отладкой |
|:-----------:|:----------:|
| ![output_test (1)](https://github.com/user-attachments/assets/1818eb69-2116-459b-97b4-c27943f17b0a) | ![output_test](https://github.com/user-attachments/assets/d5169401-ac7f-429a-ae84-71a75074c549) |

Также система сохраняет текстовый файл со следующими характеристиками по игре:
  1. Количество ударов и подач каждого игрока
  2. Доли успешных подач каждого игрока
  3. Доли двойных ошибок при подачах каждого игрока
  4. Количество совершенных розыгрышей
  5. Среднее и максимальное число ударов за розыгрыши
  6. Длина пробега каждого игрока в метрах
  7. Средние и максимальные скорости каждого игрока в км/ч
  8. Видео горизонтального мини корта и покрываемость корта:
  <table>
    <tr>
      <td align="center">
        <img src="https://github.com/user-attachments/assets/0f2ac705-cfd0-47e8-84fa-c26e597ce27a" width="400">
      </td>
      <td align="center">
        <img src="https://github.com/user-attachments/assets/4985e427-32e1-4528-9d97-a6ef89c63f8a" width="400">
      </td>
    </tr>
  </table>

# Реализация

# Обучение моделей
Для детекций были выбраны следующие модели:
- yolov8s для детекции игроков и сетки;
- yolov26n для детекции мяча;
- yolo26s-pose для детекции основных точек корта.

Датасеты были собраны на платформе Roboflow. Размечены кадры с любительских видео и профессиональных турниров с разных ракурсов, при разном освещении и с разных локаций. Ссылки на итоговые датасеты:
- https://universe.roboflow.com/tennisa-cort/tennis-detection-uqgca-n2s8p (для точек корта)
- https://universe.roboflow.com/tennis-detection-rxf2c/tennis-only-ball-fsmnu (для мяча)
- https://universe.roboflow.com/tennis-detection-rxf2c/tennis-wjzny (для сетки и игроков)

*Уточнение: последний датасет вообще содержит 4 класса вместо 2. Помимо сетки и игроков размечены мяч и ракетки, однако общее число кадров слишком мало для качественного обучения таких мелких объектов, поэтому невозможно обучить эффективно определять ограничивающие рамки мяча и ракеток по этому датасету.*

Результаты обучения моделей:
<table>
  <tr>
    <th>Детекция мяча</th>
    <th>Детекция игрока, сетки, мяча, ракетки</th>
  </tr>
  <tr>
    <td align="center">
      <img width="600" height="545" alt="Обнаружение мяча" src="https://github.com/user-attachments/assets/3ececfbc-7e53-4116-844f-46486147d936" />
    </td>
    <td align="center">
      <img width="600" height="545" alt="Обнаружение объектов" src="https://github.com/user-attachments/assets/7724f28d-77aa-49b8-a357-f3763f15a030" />
    </td>
  </tr>
</table>

